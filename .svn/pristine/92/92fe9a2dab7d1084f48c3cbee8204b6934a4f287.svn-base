<?php

namespace App\Http\Requests;

use App\Models\MT02CalendarPtn;
use Illuminate\Foundation\Http\FormRequest;

class MT02CalendarPtnRequest extends FormRequest
{
    public function rules()
    {
        $rules = [];

        $input_data = $this->request->all();
        $workptn = $input_data['WorkPtn'];
        $exitCheck = MT02CalendarPtn::where(['CALENDAR_CD' => $input_data['CalendarCd']])->exists();
        
        if (empty($input_data['CalendarCd']) || empty($input_data['CalendarPtnName']) || $input_data['CalendarCd'] == '999' || $exitCheck){
            $rules = [
                    'CalendarCd' => [
                        'required',
                        function ($attribute, $value, $fail) {
                            // チェック２処理（CD-4004）'999は使用できません。'
                            if($value == '999'){
                                $fail('4004');
                            }
                        },
                        function ($attribute, $value, $fail) {
                            $changeCd = $this->request->get('changeCd');
                            $exitCheck = MT02CalendarPtn::where(['CALENDAR_CD' => $value])->exists();

                            if($exitCheck){
                                // 新規登録で該当データあり
                                // チェック３処理（CD-2001）'該当データが存在します。'
                                $fail('2001');
                            }
                        }
                    ],
                    'CalendarPtnName' => ['required'],
                ];
            return $rules;
        }

        if($workptn = 'rbUsuallyWork' && $workptn != 'rbShiftWork'){
            if (($input_data = 'CalendarCd' || $input_data = 'CalendarPtnName') || $input_data['CalendarCd'] !== '999' || !$exitCheck) {  

                $rules = [
                    'ddlMonWorkPtn' => ['required'],
                    'ddlTueWorkPtn' => ['required'],
                    'ddlWedWorkPtn' => ['required'],
                    'ddlThuWorkPtn' => ['required'],
                    'ddlFriWorkPtn' => ['required'],
                    'ddlSatWorkPtn' => ['required'],
                    'ddlSunWorkPtn' => ['required'],
                    'ddlHldWorkPtn' => ['required'],
                ];
                return $rules;
            }
        }
        return $rules;
    }
    
    public function messages()
    {
        //（CD-2002）'必須入力項目です。'
        return [
            'CalendarCd.required' => '2002',
            'CalendarPtnName.required' => '2002',
            'ddlMonWorkPtn.required' => '2002',
            'ddlTueWorkPtn.required' => '2002',
            'ddlWedWorkPtn.required' => '2002',
            'ddlThuWorkPtn.required' => '2002',
            'ddlFriWorkPtn.required' => '2002',
            'ddlSatWorkPtn.required' => '2002',
            'ddlSunWorkPtn.required' => '2002',
            'ddlHldWorkPtn.required' => '2002',
        ];
    }
}

