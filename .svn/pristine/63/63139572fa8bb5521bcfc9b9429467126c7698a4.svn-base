<?php

namespace App\Http\Requests;

use App\Models\MT10Emp;
use App\Http\Requests\BaseRequest;
use Illuminate\Foundation\Http\FormRequest;

class MT10EmpEditRequest extends BaseRequest
{
    public function rules()
    {
        return $rules = [
            'EMP_CD' => [
                'required',
                'regex:/^[a-zA-Z0-9]+$/',
                function($attribute, $value, $fail) {
                    $input_data = $this->all();
                    $changeEmpCd = $input_data['change'];
                    $check = MT10Emp::where('EMP_CD', $value)->exists();
                    if ($changeEmpCd == null && $check) {
                        // 2001メッセージ取得（該当データが存在します。)
                        $fail('2001');
                    } else if ($changeEmpCd != null && !$check) {
                        // 更新時、更新前データなし
                        // 2000メッセージ取得（該当データが存在しません。)
                        $fail('2000');
                    }
                }
            ], 
            'EMP_NAME' => [
                'required',
                'regex:/^[^|]+$/',
            ],
            'EMP_KANA' => ['required',],
            'DEPT_CD' => [
                'required',
                parent::existDeptCdWithAuth(),
            ],
            'ENT_YEAR' => parent::ymdCheck('ENT_YEAR', 'ENT_MONTH', 'ENT_DAY'),
            'RET_YEAR' => parent::ymdCheck('RET_YEAR', 'RET_MONTH', 'RET_DAY'),
            'REG_CLS_CD' => ['required',],
            'BIRTH_YEAR' => parent::ymdCheck('BIRTH_YEAR', 'BIRTH_MONTH', 'BIRTH_DAY'),
            'SEX_CLS_CD' => ['required',],
            'EMP_CLS1_CD' => ['required',],
            'EMP_CLS2_CD' => ['required',],
            'CALENDAR_CD' => ['required',],
            'POST_CD' => [], // 形式
            'ADDRESS1' => [], // 形式
            'ADDRESS2' => [], // 形式
            'TEL' => [], // 形式
            'CELLULAR' => [], // 形式
            'MAIL' => [], // 形式
            'PH_GRANT_YEAR' => parent::ymCheck('PH_GRANT_YEAR', 'PH_GRANT_MONTH'),
            'CLOSING_DATE_CD' => ['required',],
        ];
    }


    public function messages()
    {
        // 2002メッセージ取得（必須入力項目です)
        // 2025メッセージ取得（英数字以外の文字が含まれています。)
        // 4001メッセージ取得(禁則文字([|])が含まれています。)

        return [
            'EMP_CD.required' => '2002',
            'EMP_CD.regex' => '2025',
            'EMP_NAME.required' => '2002',
            'EMP_NAME.regex' => '4001',
            'EMP_KANA.required' => '2002',
            'DEPT_CD.required' => '2002',
            'REG_CLS_CD.required' => '2002',
            'SEX_CLS_CD.required' => '2002',
            'EMP_CLS1_CD.required' => '2002',
            'EMP_CLS2_CD.required' => '2002',
            'CALENDAR_CD.required' => '2002',
            'CLOSING_DATE_CD.required' => '2002',
        ];
    }
}
