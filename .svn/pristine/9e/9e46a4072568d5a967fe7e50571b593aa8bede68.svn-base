<?php

namespace App\Repositories\Work_Time;

use Illuminate\Http\Request;

use App\Models\TR01Work;
use App\Models\MT05Workptn;
use App\Models\MT09Reason;
use App\Models\MT99Msg;
use App\Models\MT08Holiday;
use App\Models\MT10Emp;
use App\Models\Wk01Work;
use App\Models\MT94WorkDesc;

class WorkTimeRepository
{

    public function select(Request $request)
    {
        $input = $request->all();
// edit 2022/04/11 ティン　Start
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);
        $procCd = 'SW';
        $logCd = '100'; 
        $empCd = $input['txtEmpCd'];
// edit 2022/04/11 ティン　End
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

// edit 2022/04/11 ティン　Start
        $totalString = '"' . $procCd . "," . $logCd . "," . $empCd . "," . $year . "," . $month . '"';
        $command = ".\\WorkTmCon\WorkTmCon " . $totalString;
        exec($command, $output, $result_code);
// edit 2022/04/11 ティン　End

// edit 2022/04/11 ティン-----Start-----
        // $targetdata = TR01Work::join('MT05_WORKPTN', 'TR01_WORK.WORKPTN_CD', '=', 'MT05_WORKPTN.WORKPTN_CD')
        //     ->join('MT09_REASON', 'TR01_WORK.REASON_CD', '=', 'MT09_REASON.REASON_CD')
        //     ->where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->select('TR01_WORK.*', 'MT05_WORKPTN.WORKPTN_NAME', 'MT05_WORKPTN.WORK_CLS_CD', 'MT09_REASON.REASON_NAME', 'MT09_REASON.REASON_PTN_CD')
        //     ->selectRaw("Case When TR01_WORK.OFC_TIME_HH = '0' OR TR01_WORK.OFC_TIME_HH Is Null THEN ''
        //                 Else Cast(TR01_WORK.OFC_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OFC_TIME_MI As VarChar), 2)
        //             End As OFC_TIME")
        //     ->selectRaw("Case When TR01_WORK.LEV_TIME_HH = '0' OR TR01_WORK.LEV_TIME_HH Is Null Then ''
        //                 Else Cast(TR01_WORK.LEV_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.LEV_TIME_MI As VarChar), 2)
        //             End As LEV_TIME")
        //     ->selectRaw("Case When TR01_WORK.OUT1_TIME_HH = '0' OR TR01_WORK.OUT1_TIME_HH Is Null Then ''
        //                 Else Cast(TR01_WORK.OUT1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OUT1_TIME_MI As VarChar), 2)
        //             End As OUT1_TIME")
        //     ->selectRaw("Case When TR01_WORK.IN1_TIME_HH = '0' OR TR01_WORK.IN1_TIME_HH Is Null Then ''
        //                 Else Cast(TR01_WORK.IN1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.IN1_TIME_MI As VarChar), 2)
        //             End As IN1_TIME")
        //     ->selectRaw("Case When TR01_WORK.OUT2_TIME_HH = '0' OR TR01_WORK.OUT2_TIME_HH Is Null Then ''
        //                 Else Cast(TR01_WORK.OUT2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OUT2_TIME_MI As VarChar), 2)
        //             End As OUT2_TIME")
        //     ->selectRaw("Case When TR01_WORK.IN2_TIME_HH = '0' OR TR01_WORK.IN2_TIME_HH Is Null Then ''
        //                 Else Cast(TR01_WORK.IN2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.IN2_TIME_MI As VarChar), 2)
        //             End As IN2_TIME")
        //     ->selectRaw("Case When TR01_WORK.WORK_TIME_HH + TR01_WORK.WORK_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.WORK_TIME_HH  As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.WORK_TIME_MI  As VarChar), 2)
        //             End As WORK_TIME")
        //     ->selectRaw("Case When TR01_WORK.TARD_TIME_HH + TR01_WORK.TARD_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.TARD_TIME_HH  As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.TARD_TIME_MI  As VarChar), 2)
        //             End As TARD_TIME")
        //     ->selectRaw("Case When TR01_WORK.LEAVE_TIME_HH + TR01_WORK.LEAVE_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.LEAVE_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.LEAVE_TIME_MI As VarChar), 2)
        //             End As LEAVE_TIME")
        //     ->selectRaw("Case When TR01_WORK.OUT_TIME_HH + TR01_WORK.OUT_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.OUT_TIME_HH   As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OUT_TIME_MI   As VarChar), 2)
        //             End As OUT_TIME")
        //     ->selectRaw("Case When TR01_WORK.OVTM1_TIME_HH + TR01_WORK.OVTM1_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.OVTM1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OVTM1_TIME_MI As VarChar), 2)
        //             End As OVTM1_TIME")
        //     ->selectRaw("Case When TR01_WORK.OVTM2_TIME_HH + TR01_WORK.OVTM2_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.OVTM2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OVTM2_TIME_MI As VarChar), 2)
        //             End As OVTM2_TIME")
        //     ->selectRaw("Case When TR01_WORK.OVTM3_TIME_HH + TR01_WORK.OVTM3_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.OVTM3_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OVTM3_TIME_MI As VarChar), 2)
        //             End As OVTM3_TIME")
        //     ->selectRaw("Case When TR01_WORK.OVTM4_TIME_HH + TR01_WORK.OVTM4_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.OVTM4_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OVTM4_TIME_MI As VarChar), 2)
        //             End As OVTM4_TIME")
        //     ->selectRaw("Case When TR01_WORK.OVTM5_TIME_HH + TR01_WORK.OVTM5_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.OVTM5_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OVTM5_TIME_MI As VarChar), 2)
        //             End As OVTM5_TIME")
        //     ->selectRaw("Case When TR01_WORK.OVTM6_TIME_HH + TR01_WORK.OVTM6_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.OVTM6_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.OVTM6_TIME_MI As VarChar), 2)
        //             End As OVTM6_TIME")
        //     ->selectRaw("Case When TR01_WORK.EXT1_TIME_HH + TR01_WORK.EXT1_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.EXT1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.EXT1_TIME_MI As VarChar), 2)
        //             End As EXT1_TIME")
        //     ->selectRaw("Case When TR01_WORK.EXT2_TIME_HH + TR01_WORK.EXT2_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.EXT2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.EXT2_TIME_MI As VarChar), 2)
        //             End As EXT2_TIME")
        //     ->selectRaw("Case When TR01_WORK.EXT3_TIME_HH + TR01_WORK.EXT3_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.EXT3_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.EXT3_TIME_MI As VarChar), 2)
        //             End As EXT3_TIME")
        //     ->selectRaw("Case When TR01_WORK.RSV1_TIME_HH + TR01_WORK.RSV1_TIME_MI = 0 Then ''
        //                 Else Cast(TR01_WORK.RSV1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(TR01_WORK.RSV1_TIME_MI As VarChar), 2)
        //             End As RSV1_TIME")

        //     ->get();

        // return $targetdata;

        $targetdata = Wk01Work::join('MT05_WORKPTN', 'WK01_WORK.WORKPTN_CD', '=', 'MT05_WORKPTN.WORKPTN_CD')
            ->join('MT09_REASON', 'WK01_WORK.REASON_CD', '=', 'MT09_REASON.REASON_CD')
            ->where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->select('WK01_WORK.*', 'MT05_WORKPTN.WORKPTN_NAME', 'MT05_WORKPTN.WORK_CLS_CD', 'MT09_REASON.REASON_NAME', 'MT09_REASON.REASON_PTN_CD')
            ->selectRaw("Case When WK01_WORK.OFC_TIME_HH = '0' OR WK01_WORK.OFC_TIME_HH Is Null THEN ''
                        Else Cast(WK01_WORK.OFC_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OFC_TIME_MI As VarChar), 2)
                    End As OFC_TIME")
            ->selectRaw("Case When WK01_WORK.LEV_TIME_HH = '0' OR WK01_WORK.LEV_TIME_HH Is Null Then ''
                        Else Cast(WK01_WORK.LEV_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.LEV_TIME_MI As VarChar), 2)
                    End As LEV_TIME")
            ->selectRaw("Case When WK01_WORK.OUT1_TIME_HH = '0' OR WK01_WORK.OUT1_TIME_HH Is Null Then ''
                        Else Cast(WK01_WORK.OUT1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OUT1_TIME_MI As VarChar), 2)
                    End As OUT1_TIME")
            ->selectRaw("Case When WK01_WORK.IN1_TIME_HH = '0' OR WK01_WORK.IN1_TIME_HH Is Null Then ''
                        Else Cast(WK01_WORK.IN1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.IN1_TIME_MI As VarChar), 2)
                    End As IN1_TIME")
            ->selectRaw("Case When WK01_WORK.OUT2_TIME_HH = '0' OR WK01_WORK.OUT2_TIME_HH Is Null Then ''
                        Else Cast(WK01_WORK.OUT2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OUT2_TIME_MI As VarChar), 2)
                    End As OUT2_TIME")
            ->selectRaw("Case When WK01_WORK.IN2_TIME_HH = '0' OR WK01_WORK.IN2_TIME_HH Is Null Then ''
                        Else Cast(WK01_WORK.IN2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.IN2_TIME_MI As VarChar), 2)
                    End As IN2_TIME")
            ->selectRaw("Case When WK01_WORK.WORK_TIME_HH + WK01_WORK.WORK_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.WORK_TIME_HH  As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.WORK_TIME_MI  As VarChar), 2)
                    End As WORK_TIME")
            ->selectRaw("Case When WK01_WORK.TARD_TIME_HH + WK01_WORK.TARD_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.TARD_TIME_HH  As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.TARD_TIME_MI  As VarChar), 2)
                    End As TARD_TIME")
            ->selectRaw("Case When WK01_WORK.LEAVE_TIME_HH + WK01_WORK.LEAVE_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.LEAVE_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.LEAVE_TIME_MI As VarChar), 2)
                    End As LEAVE_TIME")
            ->selectRaw("Case When WK01_WORK.OUT_TIME_HH + WK01_WORK.OUT_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.OUT_TIME_HH   As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OUT_TIME_MI   As VarChar), 2)
                    End As OUT_TIME")
            ->selectRaw("Case When WK01_WORK.OVTM1_TIME_HH + WK01_WORK.OVTM1_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.OVTM1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OVTM1_TIME_MI As VarChar), 2)
                    End As OVTM1_TIME")
            ->selectRaw("Case When WK01_WORK.OVTM2_TIME_HH + WK01_WORK.OVTM2_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.OVTM2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OVTM2_TIME_MI As VarChar), 2)
                    End As OVTM2_TIME")
            ->selectRaw("Case When WK01_WORK.OVTM3_TIME_HH + WK01_WORK.OVTM3_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.OVTM3_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OVTM3_TIME_MI As VarChar), 2)
                    End As OVTM3_TIME")
            ->selectRaw("Case When WK01_WORK.OVTM4_TIME_HH + WK01_WORK.OVTM4_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.OVTM4_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OVTM4_TIME_MI As VarChar), 2)
                    End As OVTM4_TIME")
            ->selectRaw("Case When WK01_WORK.OVTM5_TIME_HH + WK01_WORK.OVTM5_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.OVTM5_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OVTM5_TIME_MI As VarChar), 2)
                    End As OVTM5_TIME")
            ->selectRaw("Case When WK01_WORK.OVTM6_TIME_HH + WK01_WORK.OVTM6_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.OVTM6_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.OVTM6_TIME_MI As VarChar), 2)
                    End As OVTM6_TIME")
            ->selectRaw("Case When WK01_WORK.EXT1_TIME_HH + WK01_WORK.EXT1_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.EXT1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.EXT1_TIME_MI As VarChar), 2)
                    End As EXT1_TIME")
            ->selectRaw("Case When WK01_WORK.EXT2_TIME_HH + WK01_WORK.EXT2_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.EXT2_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.EXT2_TIME_MI As VarChar), 2)
                    End As EXT2_TIME")
            ->selectRaw("Case When WK01_WORK.EXT3_TIME_HH + WK01_WORK.EXT3_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.EXT3_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.EXT3_TIME_MI As VarChar), 2)
                    End As EXT3_TIME")
            ->selectRaw("Case When WK01_WORK.RSV1_TIME_HH + WK01_WORK.RSV1_TIME_MI = 0 Then ''
                        Else Cast(WK01_WORK.RSV1_TIME_HH As VarChar) + ':' + RIGHT('00' + Cast(WK01_WORK.RSV1_TIME_MI As VarChar), 2)
                    End As RSV1_TIME")

            ->get();
        return $targetdata;
// edit 2022/04/11 ティン-----End-----
    }

//2022.02.05 tin add-----start-----
    /**
     *  部門名・社員名の取得
     *
     * @param Request $request
     * @return void
     */
    public function name(Request $request){
        $search_name =  $request->Input();
        if(!empty($search_name['txtEmpCd'])){
            $empName = MT10Emp::join('MT12_DEPT', 'MT10_EMP.DEPT_CD', 'MT12_DEPT.DEPT_CD',)
            ->where('EMP_CD', $search_name['txtEmpCd'])->get();
            // dd($empName);
            return $empName;
        }

    }
//2022.02.05 tin add-----end-----

    //出勤回数の合計
    public function workdaycnt(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $workdaycnt = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectraw('Sum(WORKDAY_CNT) as SUM_WORKDAY_CNT')
        //     ->first();
        // return $workdaycnt;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));
        
        $workdaycnt = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectraw('Sum(WORKDAY_CNT) as SUM_WORKDAY_CNT')
            ->first();
        return $workdaycnt;
// edit 2022/04/11 ティン-----End-----
    }

    //休出回数の合計
    public function holworkcnt(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $holworkcnt = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw('Sum(HOLWORK_CNT) as SUM_HOLWORK_CNT')
        //     ->first();
        // return $holworkcnt;
        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $holworkcnt = TR01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw('Sum(HOLWORK_CNT) as SUM_HOLWORK_CNT')
            ->first();
        return $holworkcnt;

// edit 2022/04/11 ティン-----End-----        
    }

    //特休回数の合計
    public function spcholcnt(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $spcholcnt = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw('Sum(SPCHOL_CNT) as SUM_SPCHOL_CNT')
        //     ->first();

        // return $spcholcnt;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $spcholcnt = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw('Sum(SPCHOL_CNT) as SUM_SPCHOL_CNT')
            ->first();

        return $spcholcnt;
// edit 2022/04/11 ティン-----End-----   
    }

    //有休回数の合計
    public function padholcnt(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $padholcnt = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw('Sum(PADHOL_CNT) as SUM_PADHOL_CNT')
        //     ->first();

        // return $padholcnt;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $padholcnt = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw('Sum(PADHOL_CNT) as SUM_PADHOL_CNT')
            ->first();

        return $padholcnt;
// edit 2022/04/11 ティン-----End-----   
    }

    //欠勤回数の合計
    public function abcworkcnt(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----  
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $abcworkcnt = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw('Sum(ABCWORK_CNT) as SUM_ABCWORK_CNT')
        //     ->first();
            
        // return $abcworkcnt;
        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $abcworkcnt = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw('Sum(ABCWORK_CNT) as SUM_ABCWORK_CNT')
            ->first();
            
        return $abcworkcnt;
// edit 2022/04/11 ティン-----End-----  
    }

    //代休回数の合計
    public function compdaycnt(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----          
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $compdaycnt = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw('Sum(COMPDAY_CNT) as SUM_COMPDAY_CNT')
        //     ->first();

        // return $compdaycnt;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $compdaycnt = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw('Sum(COMPDAY_CNT) as SUM_COMPDAY_CNT')
            ->first();

        return $compdaycnt;
// edit 2022/04/11 ティン-----End-----
    }

    //出勤時間の合計
    public function worktime(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----        
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $worktime = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(WORK_TIME_HH), 0) + IsNull(Sum(WORK_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(WORK_TIME_MI) % 60, 0) As VarChar), 2) SUM_WORK_TIME")
        //     ->first();

        // return $worktime;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $worktime = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(WORK_TIME_HH), 0) + IsNull(Sum(WORK_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(WORK_TIME_MI) % 60, 0) As VarChar), 2) SUM_WORK_TIME")
            ->first();

        return $worktime;
// edit 2022/04/11 ティン-----End----- 
    }

    //遅刻時間の合計
    public function tardtime(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $tardtime = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(TARD_TIME_HH), 0) + IsNull(Sum(TARD_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(TARD_TIME_MI) % 60, 0) As VarChar), 2) SUM_TARD_TIME")
        //     ->first();
            
        // return $tardtime;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $tardtime = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(TARD_TIME_HH), 0) + IsNull(Sum(TARD_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(TARD_TIME_MI) % 60, 0) As VarChar), 2) SUM_TARD_TIME")
            ->first();
            
        return $tardtime;

// edit 2022/04/11 ティン-----End----- 
    }

    //早退時間の合計
    public function leavetime(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----        
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $leavetime = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(LEAVE_TIME_HH), 0) + IsNull(Sum(LEAVE_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(LEAVE_TIME_MI) % 60, 0) As VarChar), 2) SUM_LEAVE_TIME")
        //     ->first();
            
        // return $leavetime;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $leavetime = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(LEAVE_TIME_HH), 0) + IsNull(Sum(LEAVE_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(LEAVE_TIME_MI) % 60, 0) As VarChar), 2) SUM_LEAVE_TIME")
            ->first();
            
        return $leavetime;
// edit 2022/04/11 ティン-----End----- 
    }

    //外出時間の合計
    public function outtime(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----           
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $outtime = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(OUT_TIME_HH), 0) + IsNull(Sum(OUT_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OUT_TIME_MI) % 60, 0) As VarChar), 2) SUM_OUT_TIME")
        //     ->first();
            
        // return $outtime;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $outtime = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(OUT_TIME_HH), 0) + IsNull(Sum(OUT_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OUT_TIME_MI) % 60, 0) As VarChar), 2) SUM_OUT_TIME")
            ->first();
            
        return $outtime;
// edit 2022/04/11 ティン-----End----- 
    }

    //早出時間の合計
    public function ovtm1time(Request $request)
    {
// edit 2022/04/11 ティン-----Start----- 
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ovtm1time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(OVTM1_TIME_HH), 0) + IsNull(Sum(OVTM1_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM1_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM1_TIME")
        //     ->first();
            
        // return $ovtm1time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ovtm1time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(OVTM1_TIME_HH), 0) + IsNull(Sum(OVTM1_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM1_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM1_TIME")
            ->first();
            
        return $ovtm1time;
// edit 2022/04/11 ティン-----End-----  
    }

    //普通残業時間の合計
    public function ovtm2time(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ovtm2time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(OVTM2_TIME_HH), 0) + IsNull(Sum(OVTM2_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM2_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM2_TIME")
        //     ->first();
            
        // return $ovtm2time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ovtm2time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(OVTM2_TIME_HH), 0) + IsNull(Sum(OVTM2_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM2_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM2_TIME")
            ->first();
            
        return $ovtm2time;
// edit 2022/04/11 ティン-----Start-----
    }

    //深夜残業時間の合計
    public function ovtm3time(Request $request)
    {
// edit 2022/04/11 ティン-----Start----- 
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ovtm3time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(OVTM3_TIME_HH), 0) + IsNull(Sum(OVTM3_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM3_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM3_TIME")
        //     ->first();
            
        // return $ovtm3time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ovtm3time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(OVTM3_TIME_HH), 0) + IsNull(Sum(OVTM3_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM3_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM3_TIME")
            ->first();
            
        return $ovtm3time;
// edit 2022/04/11 ティン-----End-----
    }

    //休日残業時間の合計
    public function ovtm4time(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ovtm4time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(OVTM4_TIME_HH), 0) + IsNull(Sum(OVTM4_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM4_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM4_TIME")
        //     ->first();
            
        // return $ovtm4time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ovtm4time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(OVTM4_TIME_HH), 0) + IsNull(Sum(OVTM4_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM4_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM4_TIME")
            ->first();
            
        return $ovtm4time;
// edit 2022/04/11 ティン-----End----- 
    }

    //休日深夜残業時間の合計
    public function ovtm5time(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ovtm5time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(OVTM5_TIME_HH), 0) + IsNull(Sum(OVTM5_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM5_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM5_TIME")
        //     ->first();
            
        // return $ovtm5time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ovtm5time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(OVTM5_TIME_HH), 0) + IsNull(Sum(OVTM5_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM5_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM5_TIME")
            ->first();
            
        return $ovtm5time;
// edit 2022/04/11 ティン-----End-----  
    }

    //残業項目６の合計(空)
    public function ovtm6time(Request $request)
    {
// edit 2022/04/11 ティン-----Start----- 
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ovtm6time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(OVTM6_TIME_HH), 0) + IsNull(Sum(OVTM6_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM6_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM6_TIME")
        //     ->first();
            
        // return $ovtm6time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ovtm6time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(OVTM6_TIME_HH), 0) + IsNull(Sum(OVTM6_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(OVTM6_TIME_MI) % 60, 0) As VarChar), 2) SUM_OVTM6_TIME")
            ->first();
            
        return $ovtm6time;
// edit 2022/04/11 ティン-----End-----
    }

    //深夜割増
    public function ext1time(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ext1time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(EXT1_TIME_HH), 0) + IsNull(Sum(EXT1_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(EXT1_TIME_MI) % 60, 0) As VarChar), 2) SUM_EXT1_TIME")
        //     ->first();
            
        // return $ext1time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ext1time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(EXT1_TIME_HH), 0) + IsNull(Sum(EXT1_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(EXT1_TIME_MI) % 60, 0) As VarChar), 2) SUM_EXT1_TIME")
            ->first();
            
        return $ext1time;
// edit 2022/04/11 ティン-----End----- 
    }

    //割増項目２の合計(空)
    public function ext2time(Request $request)
    {
// edit 2022/04/11 ティン-----Start----- 
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ext2time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(EXT2_TIME_HH), 0) + IsNull(Sum(EXT2_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(EXT2_TIME_MI) % 60, 0) As VarChar), 2) SUM_EXT2_TIME")
        //     ->first();
            
        // return $ext2time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $ext2time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(EXT2_TIME_HH), 0) + IsNull(Sum(EXT2_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(EXT2_TIME_MI) % 60, 0) As VarChar), 2) SUM_EXT2_TIME")
            ->first();
            
        return $ext2time;
// edit 2022/04/11 ティン-----End-----
    }

    //割増項目3の合計(空)
    public function ext3time(Request $request)
    {
// edit 2022/04/11 ティン-----Start----- 
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $ext3time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(EXT3_TIME_HH), 0) + IsNull(Sum(EXT3_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(EXT3_TIME_MI) % 60, 0) As VarChar), 2) SUM_EXT3_TIME")
        //     ->first();
            
        // return $ext3time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = (substr(($input['ddlDate']), 7, 2));

        $ext3time = TR01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(EXT3_TIME_HH), 0) + IsNull(Sum(EXT3_TIME_MI) / 60, 0) As VarChar) + ':' + Right('00' + Cast(IsNull(Sum(EXT3_TIME_MI) % 60, 0) As VarChar), 2) SUM_EXT3_TIME")
            ->first();
            
        return $ext3time;
// edit 2022/04/11 ティン-----End-----
    }

    //出勤時間、残業項目１～ｎの合計
    public function GetSumTime(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $sumtime = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(WORK_TIME_HH) + Sum(OVTM1_TIME_HH) + Sum(OVTM2_TIME_HH) + Sum(OVTM3_TIME_HH) + Sum(OVTM4_TIME_HH) + Sum(OVTM5_TIME_HH) + Sum(OVTM6_TIME_HH),0) +
        //                  IsNull((Sum(WORK_TIME_MI) + Sum(OVTM1_TIME_MI)  + Sum(OVTM2_TIME_MI) + Sum(OVTM3_TIME_MI) + Sum(OVTM4_TIME_MI) + Sum(OVTM5_TIME_MI) + Sum(OVTM6_TIME_MI)) /60, 0) As VarChar) + ':' + 
        //                  Right('00' + Cast(IsNull((Sum(WORK_TIME_MI) + Sum(OVTM1_TIME_MI)  + Sum(OVTM2_TIME_MI) + Sum(OVTM3_TIME_MI) + Sum(OVTM4_TIME_MI) + Sum(OVTM5_TIME_MI) + Sum(OVTM6_TIME_MI)) % 60, 0) As VarChar), 2) SUM_TIMES")
        //     ->first();
            
        // return $sumtime;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $sumtime = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(WORK_TIME_HH) + Sum(OVTM1_TIME_HH) + Sum(OVTM2_TIME_HH) + Sum(OVTM3_TIME_HH) + Sum(OVTM4_TIME_HH) + Sum(OVTM5_TIME_HH) + Sum(OVTM6_TIME_HH),0) +
                         IsNull((Sum(WORK_TIME_MI) + Sum(OVTM1_TIME_MI)  + Sum(OVTM2_TIME_MI) + Sum(OVTM3_TIME_MI) + Sum(OVTM4_TIME_MI) + Sum(OVTM5_TIME_MI) + Sum(OVTM6_TIME_MI)) /60, 0) As VarChar) + ':' + 
                         Right('00' + Cast(IsNull((Sum(WORK_TIME_MI) + Sum(OVTM1_TIME_MI)  + Sum(OVTM2_TIME_MI) + Sum(OVTM3_TIME_MI) + Sum(OVTM4_TIME_MI) + Sum(OVTM5_TIME_MI) + Sum(OVTM6_TIME_MI)) % 60, 0) As VarChar), 2) SUM_TIMES")
            ->first();
            
        return $sumtime;
// edit 2022/04/11 ティン-----End-----  
    }
    
    //割増項目１～ｎの合計
    public function GetSumExtTimes(Request $request)
    {
// edit 2022/04/11 ティン-----Start-----  
        // $input = $request->all();
        // $year = substr(($input['ddlDate']), 0, 4);
        // $month = substr(($input['ddlDate']), 7, 2);

        // $sumext_time = TR01Work::where('CALD_YEAR', (int)$year)
        //     ->where('CALD_MONTH', (int)$month)
        //     ->where('EMP_CD', $input['txtEmpCd'])
        //     ->selectRaw("Cast(IsNull(Sum(EXT1_TIME_HH) + Sum(EXT2_TIME_HH) + Sum(EXT3_TIME_HH),0) +
        //                  IsNull((Sum(EXT1_TIME_MI) + Sum(EXT2_TIME_MI)  + Sum(EXT3_TIME_MI)) /60, 0) As VarChar) + ':' + 
        //                  Right('00' + Cast(IsNull((Sum(EXT1_TIME_MI) + Sum(EXT2_TIME_MI)  + Sum(EXT3_TIME_MI)) % 60, 0) As VarChar), 2) SUM_EXT_TIMES")
        //     ->first();
            
        // return $sumext_time;

        $input = $request->all();
        $year = substr(($input['ddlDate']), 0, 4);
        $month = abs(substr(($input['ddlDate']), 7, 2));

        $sumext_time = Wk01Work::where('CALD_YEAR', (int)$year)
            ->where('CALD_MONTH', (int)$month)
            ->where('EMP_CD', $input['txtEmpCd'])
            ->selectRaw("Cast(IsNull(Sum(EXT1_TIME_HH) + Sum(EXT2_TIME_HH) + Sum(EXT3_TIME_HH),0) +
                         IsNull((Sum(EXT1_TIME_MI) + Sum(EXT2_TIME_MI)  + Sum(EXT3_TIME_MI)) /60, 0) As VarChar) + ':' + 
                         Right('00' + Cast(IsNull((Sum(EXT1_TIME_MI) + Sum(EXT2_TIME_MI)  + Sum(EXT3_TIME_MI)) % 60, 0) As VarChar), 2) SUM_EXT_TIMES")
            ->first();
            
        return $sumext_time;
// edit 2022/04/11 ティン-----End----- 
    }

    //メッセージ表示
    public function messages()
    {
        $msg_4029 = MT99Msg::where('MSG_NO', '4029')->pluck('MSG_CONT')->first();
        return $msg_4029;
    }

    //勤務体系の取得 
    public function workptns()
    {
        $workptn_names = MT05Workptn::all();
        return $workptn_names;
    }

    //自由の取得
    public function reasons()
    {
        $reason_names = MT09Reason::all();
        return $reason_names;
    }

    //フォント色更新処理
    public function holidays()
    {
        $hld_dates = MT08Holiday::pluck('HLD_DATE');

        return $hld_dates;
    }


    // public function wte_edit(Request $request, $emp_cd)
    // {
    //     $input = $request->all();

    //     $edit_data = TR01Work::join('MT05_WORKPTN', 'TR01_WORK.WORKPTN_CD', '=', 'MT05_WORKPTN.WORKPTN_CD')
    //     ->join('MT09_REASON', 'TR01_WORK.REASON_CD', '=', 'MT09_REASON.REASON_CD')
    //     ->where('CALD_YEAR', (int)$year)
    //     ->where('CALD_MONTH', (int)$month)
    //     ->where('EMP_CD', $input['txtEmpCd'])
    //     ->find($emp_cd);

    //     return $edit_data;

    // }

    // public function wte_update(Request $request)
    // {
    //     $post = new WorkTimeRepository;
    //     $data_up = $post->select($request);

    //     $data_up->WORKPTN_NAME = $request->WORKPTN_NAME;
    //     $data_up->save();

        
    //     //dd($name);
        
    // }

    // public function date(Request $request)
    // {
    //     $dates = [];
    //     $input = $request->all();
    //     $date = TR01Work::join('MT05_WORKPTN', 'TR01_WORK.WORKPTN_CD', '=', 'MT05_WORKPTN.WORKPTN_CD')
    //         ->join('MT09_REASON', 'TR01_WORK.REASON_CD', '=', 'MT09_REASON.REASON_CD')
    //         //->join('MT08_HOLIDAY', 'date(TR01_WORK.CALD_DATE)', '=' ,'MT08_HOLIDAY.HLD_DATE')
    //         ->where('CALD_YEAR', (int)$year)
    //         ->where('CALD_MONTH', (int)$month)
    //         ->where('EMP_CD', $input['txtEmpCd'])
    //         ->select('TR01_WORK.CALD_DATE')
    //         ->get();
    //         //dd($date);
    //         foreach($date as $hld_dates){
    //             $dates[] =  (date('md', strtotime($hld_dates['CALD_DATE']))); 
    //         }
                  
    //         return $dates;
    // }

    public function getHeaderName()
    {
        $work_desc_cls_cd02 = MT94WorkDesc::select('WORK_DESC_CD', 'WORK_DESC_NAME', 'WORK_DESC_CLS_CD')
            ->where('WORK_DESC_CLS_CD', '02')
            // ->orderby('WORK_DESC_CD')
            ;

        return MT94WorkDesc::select('WORK_DESC_CD', 'WORK_DESC_NAME', 'WORK_DESC_CLS_CD')
            ->where('WORK_DESC_CLS_CD', '01')
            // ->orderby('WORK_DESC_CD')
            ->unionAll($work_desc_cls_cd02)
            ->get();
    }
}
