<?php

namespace App\Http\Requests;

use Illuminate\Support\Facades\DB;
use Illuminate\Foundation\Http\FormRequest;
use App\Models\MT11Login;
use App\Models\MT10Emp;
use App\Models\MT12Dept;
use App\Models\MT13DeptAuth;
use App\Models\MT99Msg;
use App\Repositories\Search\MT10EmpSearchRepository;
use App\Repositories\Search\MT12DeptSearchRepository;
use Illuminate\Http\Request;

/**
 * 出退勤照会
 */
class EmpWorkStatusReferenceRequest extends FormRequest
{
    public function rules()
    {
        $rules = [];
        $rules = [
            'filter.ddlDate' => ['required'],
            'filter.txtDeptCd' => [
                'nullable',
                function ($attribute, $value, $fail) {
                    //** 存在チェック */
                    if (!(new MT12DeptSearchRepository())->getName($value, '01', true)) {
                        $fail('2000');
                    }
                },
            ],
            'filter.txtEmpCd' => [
                'nullable',
                function ($attribute, $value, $fail) {
                    //** 確認処理 */
                    if (!(new MT10EmpSearchRepository())->getName($value, '00', true)) {
                        $fail('2000');
                    }
                },
            ],
            'filter.check' => 'required',
        ];
        return $rules;
    }

    public function messages()
    {
        // 2002：（必須入力項目です。）
        // 4005：（事由区分が選択されていません。）
        return [
            'filter.ddlDate.required' => '2002',
            'filter.check.required' => '4005'
        ];
    }
}
