<?php

namespace App\Http\Controllers\Search;

use App\Http\Controllers\Controller;
use App\Repositories\Search\MT12DeptSearchRepository;
use App\Models\MT99Msg;
use Illuminate\Http\Request;

class MT12DeptSearchController extends Controller
{
    /**
     * Work_Timeリポジトリの実装
     *
     * @var MT12DeptSearchRepository
     */

    protected $dep_repository;

    /**
     * 新しいコントローラインスタンスの生成
     *
     * @param  UserRepository  $dep_Repository
     * @return void
     */
    public function __construct(MT12DeptSearchRepository $dep_Repository)
    {
        $this->dep_repository = $dep_Repository;
    }

    /**
     * 部門の一覧選択画面を表示する
     * @return 部門選択画面
     */
    public function search(Request $request)
    {
        $request_data = $request->all();
        $disp_cls_cd = $request->dispClsCd;
        $is_dept_auth = $request->isDeptAuth ?? false;
        $dept_search = $this->dep_repository->dataSearch($disp_cls_cd, $is_dept_auth);
        return view('search.MT12DeptSearch', compact('request_data', 'dept_search'));
    }

    /**
     * 部門名を検索して返す
     * @return 部門名
     */
    public function getName(Request $request, $dept_cd)
    {
        $disp_cls_cd = $request->dispClsCd;
        $is_dept_auth = $request->isDeptAuth ?? false;
        $dept_name = $this->dep_repository->getName($dept_cd, $disp_cls_cd, $is_dept_auth);
        $msg_2000 = "";
        if ($dept_name == null) {
            $msg_2000 = MT99Msg::where('MSG_NO', '2000')->pluck('MSG_CONT')->first();
        }
        return ['deptName' => $dept_name, 'errorMessage' => $msg_2000];
    }
}
