<?php

namespace App\Http\Controllers\master;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Http\Requests\MT23CompanyEditorRequest;
use App\Repositories\Master\Mt23CompanyRepository;
use App\Models\MT99Msg;
use App\Models\MT23Company;
use App\Models\MT94WorkDesc;
use App\Models\MT91ClsDetail;
use App\Supplier;
use Illuminate\Contracts\Session\Session;

class MT23CompanyController extends Controller
{
    //** $Mt23Company_Repositoryリポジトリの実装 */
    /**
     * @var Mt23CompanyRepository
     */
    protected $Mt23Company_Repository;

    //** コントローラインスタンスの生成 */
    /**
     * @param  Mt23CompanyRepository $Mt23Company_Repository
     * @return void
     */
    public function __construct(Mt23CompanyRepository $Mt23Company_Repository)
    {
        $this->Mt23Company_Repository = $Mt23Company_Repository;
    }

    //**所属情報照会 画面表示 **//
    /**
     * MT23 Comany会社名表示
     * @return view (MT23CompanyReference.blade)
     */
    public function MT23CompanyReferenceIndex(Request $request)
    {
        $haken_company = $this->Mt23Company_Repository->companyName();
        // dd($companyName);
        return view('master.MT23CompanyReference', compact('haken_company'));
    }

    //詳細画面の表示 修正モード
    public function edit($id)
    {
        // dd($id);
        $company_Cd = MT23Company::find($id);
        // dd($company_Cd);
        if (is_null($company_Cd)) {
            \Session::flash('err_msg', 'データがありません！');
            return redirect(route('MT23.index'));
        }

        $query_data = MT23Company::where('COMPANY_CD', $id)->get();
        // dd($query_data);
        // $query_id = MT23Company::where('COMPANY_CD', $id)->first('COMPANY_CD');
        // dd($query_id);
        $dispcls_cd = MT91ClsDetail::where('CLS_CD', '01')->orderBy('CLS_DETAIL_CD', 'ASC')->get();
        // dd($dispcls_cd);
        $msg_1005 = MT99Msg::where('MSG_NO', '1005')->pluck('MSG_CONT')->first();

        return view('master.MT23CompanyEditor', ['query_data'=>$query_data, 'dispcls_cd'=>$dispcls_cd, 'msg_1005'=>$msg_1005]);
    }

    public function update(Request $request)
    {
        //入力データを取得
        $inputData = $request->all();
        dd($inputData);

        \DB::beginTransaction();
        try {
            //COMPANY_CDを修正
            $company_Cd = MT23Company::find($inputData['id']);
            \DB::commit();
        } catch (\Throwable $e) {
            \DB::rollback();
            abort(500);
        }
        return redirect(route('MT23.index'));
    }

    //** 所属情報照会 キャセンル処理 */
    /**
     * @return view (MT23CompanyReference.blade)
     */
    public function cancelBtn(Request $request)
    {
        return redirect()->route('empworkstatusRef')->withInput($request->only(['ddlTargetYear', 'ddlTargetMonth', 'ddlTargetDay']));
    }
}
