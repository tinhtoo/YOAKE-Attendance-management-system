<?php

namespace App\Http\Controllers;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\MT10Emp;
use Illuminate\Support\Facades\DB;

class MT10EmpReferenceController extends Controller
{
    public function search(Request $request)
    {

        // クエリビルダ
        $query = MT10Emp::query();

        // 検索フォームで入力された値を取得する
        $kanasearch = $request->input('kanasearch');
        $cdsearch = $request->input('cdsearch');
        $deptsearch = $request->input('deptsearch');

        // 検索フォームにキーワードが入力されたら
        if ($kanasearch !== null) {
            if ($request->has('kanasearch') && $kanasearch != '') {
                $query->where('EMP_KANA', 'like', "%{$kanasearch}%")->get();
            }
        }

        if ($cdsearch !== null) {
            if ($request->has('cdsearch') && $cdsearch != '') {
                $query->where('EMP_CD', '=', "{$cdsearch}")->get();
            }
        }

        if ($deptsearch !== null) {
            if ($request->has('deptsearch') && $deptsearch != '') {
                $query->where('DEPT_CD', '=', "{$deptsearch}")->get();
            }
        }

        // 社員番号フォームにキーワードが入力されたら
        // if ($numsearch !== null) {
        //     if ($request->has('search') && $search != '') {
        //         $query->where('EMP_KANA', 'like', "%{$search}%")->get();
        //     }
        // }

        if (isset($_GET['button_A'])) {

            $Agyou = '[ァ-オ]';

            $query->where('EMP_KANA', 'like', "%{$Agyou}%");
        }

        if (isset($_GET['button_KA'])) {

            $KAgyou = '[カ-ゴ]';

            $query->where('EMP_KANA', 'like', "%{$KAgyou}%");
        }

        if (isset($_GET['button_SA'])) {

            $SAgyou = '[サ-ゾ]';

            $query->where('EMP_KANA', 'like', "%{$SAgyou}%");
        }

        if (isset($_GET['button_TA'])) {

            $TAgyou = '[タ-ド]';

            $query->where('EMP_KANA', 'like', "%{$TAgyou}%");
        }

        if (isset($_GET['button_NA'])) {

            $NAgyou = '[ナ-ノ]';

            $query->where('EMP_KANA', 'like', "%{$NAgyou}%");
        }

        if (isset($_GET['button_HA'])) {

            $HAgyou = '[ハ-ポ]';

            $query->where('EMP_KANA', 'like', "%{$HAgyou}%");
        }

        if (isset($_GET['button_MA'])) {

            $MAgyou = '[マ-モ]';

            $query->where('EMP_KANA', 'like', "%{$MAgyou}%");
        }

        if (isset($_GET['button_YA'])) {

            $YAgyou = '[ャ-ヨ]';

            $query->where('EMP_KANA', 'like', "%{$YAgyou}%");
        }

        if (isset($_GET['button_RA'])) {

            $RAgyou = '[ラ-ロ]';

            $query->where('EMP_KANA', 'like', "%{$RAgyou}%");
        }

        if (isset($_GET['button_WA'])) {

            $WAgyou = '[ヮ-ン]';

            $query->where('EMP_KANA', 'like', "%{$WAgyou}%");
        }

        if (isset($_GET['button_EN'])) {

            $EN = '[a-zA-Z0-9]';

            $query->where('EMP_KANA', 'like', "%{$EN}%");
        }

        $data = $query->paginate(20);

        // ビューにdataとsearchを変数として渡す
        return view('master.MT10EmpReference')->with([
            'cdsearch' => $cdsearch,
            'kanasearch' => $kanasearch,
            'deptsearch' => $deptsearch,
            'data' => $data,
        ]);
    }

}


// アラートテスト
// $alert = "<script type='text/javascript'>alert('これはalertです。');</script>"; 
// // ②echoで①を表示する
// echo $alert;

// テストソース
// public function index(Request $request)
// {
//     $query = MT10Emp::query();

//     $emp10name = $request->input('EMP_NAME');
//     $emp10kana = $request->input('EMP_KANA');
//     // $emp10cd = $request->input('EMP_CD');

//     if ($request->has('EMP_KANA') && $emp10kana != '') {
//         $query->where('EMP_KANA', 'like', "%{$emp10kana}%")->get();
//     }

//     // if ($request->has('EMP_NAME') && $emp10name != ''){
//     //     $query->where('EMP_NAME', 'like', '%' .$emp10name. '%')->get();
//     // }

//     // if ($request->has('EMP_CD') && $emp10cd != ('指定なし')){
//     //     $query->where('EMP_CD', $emp10cd)->get();
//     // }

//     $data = $query->paginate(15);

//     return view('master.MT10EmpReference', [
//         'data' => $data
//     ]);
// }